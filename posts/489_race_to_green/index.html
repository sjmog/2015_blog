<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Sam Morgan's Blog</title>

    <!-- Use Typekit fonts -->
    <script src="//use.typekit.net/dmj2ums.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>

    <link href="/stylesheets/screen.css" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>

    <!-- Syntax Highlighting -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
  </head>

  <body class="posts posts_489_race_to_green posts_489_race_to_green_index">
    <main class="main">
      <h1 id="novice-tdd-race-to-green">Novice TDD: Race to Green</h1>

<p>'Red, Green, Refactor': that's a helpful mantra for writing your code test-first. But how long should you spend on each stage, and how can you effectively separate each stage from the other? The answer: Make it Work, then Make it Good.</p>

<h3 id="race-to-green">Race to Green</h3>

<blockquote>
  <p>Race to Green. Worry about design later.</p>
</blockquote>

<p>When you're starting out with Test-Driven Development, it's hard. Why? Because TDD demands you do two things in an unpleasant order: <em>Design</em> and <em>Implement</em>. These are two pretty different mindsets, and messing them together can get you into tangles.</p>

<p>To start out, I advise that you strongly separate the two. When you're writing your first test, think <em>Design</em>. How do I want this to work? What should my interface look like?</p>

<p>For example: let's say we want to write a simple program that allows Superheroes to fight each other. We can worry about the specifics later. For now, let's start from <em>Designing an Interface</em> to your program:</p>

<pre>
  <code>
  # Make a couple of superheroes
  batman = Superhero.new('Batman', 2)
  superman = Superhero.new('Superman', 5)

  # Make them fight each other
  batman.fight(superman) # =&gt; returns superman
  superman.fight(batman) # =&gt; returns superman
  </code>
</pre>

<p>Now I've defined my interface, I can write a test that simulates this. Here, I can write a <em>Unit Test</em> that describes the scenario, because the scenario only involves one class (<code>Superhero</code>).</p>

<p>Once I have a failing test - failing because I haven't implemented the <code>#fight</code> method yet, say â€“ I need to move to the next stage: Race to Green. Here's the principle:</p>

<blockquote>
  <p>When Racing to Green, forget about principles of good design: Single Responsibility, Laws of Demeter, and so on. Just make it work, any way you can.</p>
</blockquote>

<p>Here's me Racing to Green here:</p>

<pre>
  <code>
  class Superhero
    attr_reader :power

    def initialize(name, power)
      # Only need power here to go green
      @power = power
    end

    def fight(other)
      return self if power &gt; other.power
      other
    end
  end
  </code>
</pre>

<h3 id="refactor">Refactor</h3>

<p>Now that I've gone green in the fastest, simplest way I can, I can think about design.</p>

<blockquote>
  <p>The best bit about Racing to Green? Now I can mess with my code however I like, trying out new design approaches and learning how well they work: all without worrying about functionality in my program.</p>
</blockquote>

<p>My tests will tell me if I break something: they always have my back.</p>

<blockquote>
  <p>You should be running your tests every ten to fifteen seconds, minimum</p>
</blockquote>

<p>That might seem like a lot, but running specs is like a tic for me. Even if I'm sitting thinking about my code, not writing anything, I run them every few seconds. It's reassuring to know my program works, and it frees me up to think about <em>Design and Design only</em>. Run your tests <em>a lot</em>: eventually you'll feel creeped out if you <em>don't</em> run them. That's a good habit.</p>

<p>Fiddling about a bit, let's worry about design (I've annotated my thinking first, then given the solution later):</p>

<pre>
  <code>
  class Superhero
    # I don't like how this is open to everyone
    # who needs to read this? Can I/How can I
    # ensure only they are allowed to?
    attr_reader :power

    def initialize(name, power)
      # Not using name. Do I need to change my
      # interface? What is the point of name
      # right now?
      @power = power
    end

    def fight(other)
      # Is there any way I can kill this 'if'
      # statement? If statements kinda suck
      # because they introduce hard-to-follow
      # control flow branches
      return self if power &gt; other.power
      other
    end
  end
  </code>
</pre>

<p>Here's my solution to these design problems. First, let's change the interface to get rid of <code>name</code>:</p>

<pre>
  <code>
  # Make a couple of superheroes
  # Their power is the only thing
  # relevant to my program now
  batman = Superhero.new(2)
  superman = Superhero.new(5)

  # Make them fight each other
  # No changes needed here
  batman.fight(superman) # =&gt; returns superman
  superman.fight(batman) # =&gt; returns superman
  </code>
</pre>

<p>Now let's update the class to solve those design problems:</p>

<pre>
  <code>
  class Superhero
    def initialize(power)
      @power = power
    end

    def fight(other)
      [self, other].max_by(&amp;:power)
    end

    protected
    attr_reader :power
  end
  </code>
</pre>

<p>Nice! I was freed up to Google for a <a href="http://stackoverflow.com/questions/8038993/finding-the-element-of-a-ruby-array-with-the-maximum-value-for-a-particular-attr">better solution to return a max-powered object from an array</a>, and better-encapsulated my code. My refactor is complete: now I can write another red test, race to green, and separate my design thinking from my problem-solving.</p>

    </main>
    
    <!-- highlight syntax -->
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-64373478-1', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>
