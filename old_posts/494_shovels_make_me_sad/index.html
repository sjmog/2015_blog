<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Sam Morgan's Blog</title>

    <!-- Use Typekit fonts -->
    <script src="//use.typekit.net/dmj2ums.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>

    <link href="/stylesheets/screen.css" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>

    <!-- Syntax Highlighting -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
  </head>

  <body class="old_posts old_posts_494_shovels_make_me_sad old_posts_494_shovels_make_me_sad_index">
    <main class="main">
      <h1 id="shovels-make-me-sad">Shovels make me sad</h1>

<p>Ruby's shovel operator is for mutating stuff, right? Except it isn't. The idea that « is an alias for concat() has outstripped its purpose as a bitwise operator, leading to confusion.</p>

<h3 id="the-shovel">The Shovel</h3>

<p>Not familiar with the <code>&lt;&lt;</code> ('shovel') operator?</p>

<pre>
  <code>
string_a = "Hello"
string_b = " World"

string_a &lt;&lt; string_b  # =&gt; "Hello World"

# Look! The shovel mutated string_a!
string_a              # =&gt; "Hello World"
</code>
</pre>

<p>So shovels tend to mutate stuff, 'in-place'.</p>

<h3 id="the-confusion">The confusion</h3>

<p>There is only one <code>Fixnum</code> instance for any given integer value (each instance has an <code>object_id</code> equal to the integer value * 2 + 1). Therefore, you'd expect <code>&lt;&lt;</code> to fail on Fixnum instances, because you can't mutate an object into another object:</p>

<pre>
  <code>
# This should definitely not work
1.object_id   # =&gt; 3
1 &lt;&lt; 1        # =&gt; 2 :(
2 &lt;&lt; 1        # =&gt; 4 !! :( :(

# So I guess this should happen instead
1 &lt;&lt; 1        # =&gt; NoMethodError '&lt;&lt;' for Fixnum
</code>
</pre>

<p>This 'should' happen because <code>&lt;&lt;</code> is <a href="https://www.google.co.uk/webhp?sourceid=chrome-instant&amp;ion=1&amp;espv=2&amp;ie=UTF-8#q=shovel%20ruby">commonly understood</a> to be an alias for <code>concat()</code>. BUT, in the case of <code>Fixnum</code>s:</p>

<pre>
  <code>
1 &lt;&lt; 1        # =&gt; 2
2 &lt;&lt; 1        # =&gt; 4
</code>
</pre>

<p>not only does <code>&lt;&lt;</code> not change the state of the <code>Fixnum</code> (we knew it couldn't for the reasons above), it does extra-weird stuff. That's because its primary function is as a bitwise operator, shifting bits 'leftwards' by the value passed as an argument.</p>

<h3 id="bitwise-shovels">Bitwise shovels</h3>

<p>Bitwise operators work like this: convert the value to binary, and work on that. So:</p>

<pre>
  <code>
    1.to_s(2)     # =&gt; "1" as a binary string
    1 &lt;&lt; 1        # =&gt; 10 in binary, == 2 in decimal

    2.to_s(2)     # =&gt; "10" as a binary string
    2 &lt;&lt; 1        # =&gt; 100 in binary, == 4 in decimal
  </code>
</pre>

<p>There's also a <code>&gt;&gt;</code> operator, which goes the other way.</p>

<h3 id="why-im-upset">Why I'm upset</h3>

<p>Here's the <a href="https://www.google.co.uk/webhp?sourceid=chrome-instant&amp;ion=1&amp;espv=2&amp;ie=UTF-8#q=shovel%20ruby">first page of Google results</a> for 'shovel ruby'. It's all about <code>&lt;&lt;</code> as an alias for <code>concat()</code>. So, the way it works with <code>Fixnum</code>s is very weird indeed. Until this was pointed out to me, I was awash with upset as to why <code>1.concat(1)</code> was returning <code>2</code>.</p>

<h3 id="the-call-to-action">The Call to Action</h3>

<p>So what's the deal? Why is <code>&lt;&lt;</code> used as an alias like that?</p>


    </main>
    
    <!-- highlight syntax -->
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-64373478-1', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>
